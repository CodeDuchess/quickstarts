# Additional info: https://docs.openshift.com/container-platform/4.9/web_console/creating-quick-start-tutorials.html
metadata:
  name: insights-malware-install
  # you can add additional metadata here
  instructional: true
spec:
  displayName: Install the Malware Service
  durationMinutes: 5
  # Optional type section, will display as a tile on the card
  type:
    text: Quick start
    # 'blue' | 'cyan' | 'green' | 'orange' | 'purple' | 'red' | 'grey'
    color: grey
  icon: data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KPHRpdGxlPjwvdGl0bGU+CjxnIGlkPSJpY29tb29uLWlnbm9yZSI+CjwvZz4KPHBhdGggZD0iTTQ0OCA2NHY0MTZoLTMzNmMtMjYuNTEzIDAtNDgtMjEuNDktNDgtNDhzMjEuNDg3LTQ4IDQ4LTQ4aDMwNHYtMzg0aC0zMjBjLTM1LjE5OSAwLTY0IDI4LjgtNjQgNjR2Mzg0YzAgMzUuMiAyOC44MDEgNjQgNjQgNjRoMzg0di00NDhoLTMyeiI+PC9wYXRoPgo8cGF0aCBkPSJNMTEyLjAyOCA0MTZ2MGMtMC4wMDkgMC4wMDEtMC4wMTkgMC0wLjAyOCAwLTguODM2IDAtMTYgNy4xNjMtMTYgMTZzNy4xNjQgMTYgMTYgMTZjMC4wMDkgMCAwLjAxOS0wLjAwMSAwLjAyOC0wLjAwMXYwLjAwMWgzMDMuOTQ1di0zMmgtMzAzLjk0NXoiPjwvcGF0aD4KPC9zdmc+Cg==
  prerequisites:
    - You must have sudo access to the system.
    - You must be a member of a User Access group with the Malware detection administrator role.
  description: |-
    Install YARA and the malware detection controller, test, scan and view your results.
  introduction: |-
    **Welcome to the quick start that will enable scanning for Malware signatures. 
    In this quick start, you will configure user access, install packages, and ensure that the Insights client and systems are configured correctly. 
  
  tasks:
    - title: Configure User Access
      description: |- 

        An organization administrator or User Access administrator must add users to a User Access group with the required roles. 
        The administrator must also have sudo access to the system. 

        **To create a custom role:**

        1. Navigate to the **Red Hat Hybrid Cloud Console**.
        2. Click the **Settings** icon in the top right. 
        3. Under Identity & Access Management, click **User Access**.
        4. Select the **Malware Inventory Group** option.

      # optional - the task's Check your work module
      review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
      summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header

    - title: Install YARA
      description: |-

        YARA is an open-source and multi-platform tool that detects code similarities between predefined malware signatures and a  scanned RHEL system. 
        If one or more conditions in a predefined signature exist on a scanned RHEL system. YARA records a malware hit on that system. 
        
        **NOTE**: Install the YARA Package on each host you want to scan for Malware and Ensure the Systemâ€™s Operating System versions are either RHEL 8 or RHEL 9.  

        1. Install YARA: 
        ```
        sudo dnf install yara 
        ```   
      # optional - the task's Check your work module
      review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
      summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header
 
    - title: Install Insights Client and Register to RHEL 
      #description: |- 

         1. Install Insights client:
         ```
         sudo dnf install insights-client 
         ```   
         2. Test the Insights client connection:
         ```
         sudo insights-client --test-connection
         ```   
         3. Register the system with Insights for Red Hat Enterprise Linux :
         ```
         sudo insights-client --register
         ```      
      # optional - the task's Check your work module
      review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
      summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header

    -  title: Run the Malware detection collector 
      description: |-
        Run the Malware detection tool and connect to Insights.
      introduction: |-
        **Welcome to the quick start for running the malware detection tool and connecting to Insights. Make sure to complete **The Configure User Access quick start** before attempting this quick start.
        In this quick start, you will run the client malware detection collector on your hosts, make the scans live on Insights, and complete full filesystem scans. 
     
    - title: Initial run of the Malware detection collector 
         1. Run the Insights client malware detection collector:
         ```
         sudo insights-client --collector malware-detection
         ```   
        The initial run creates a malware detection configuration file in 
        ```
        /etc/insights-client/malware-detection-config.yml
        ```
        , performs a test scan, and uploads the results.

        2. Make scans live on Insights:
        ```
        vi /etc/insights-client/malware-detection-config.yml 
        ```   
    - title: Full file system scan
        1. Edit 
        ```
        /etc/insights-client/malware-detection-config.yml
        ```
        a. Set the test scan option from **true** to **false**. 
        ```
        test_scan: false
        ```
        b. Minimize scan time by setting any of the following options: 
	      ```
        Filesystem_scan_only
        ```
        ```
        Filesystem_scan_exclude
        ```
        ```
        Filesystem_scan_since
        ```
        c. Re-run the client malware detection collector 
	      ```
        sudo insights-client --collector malware-detection
        ```
      # optional - the task's Check your work module
      review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
      summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header


    - title:  Optional: Scan Processes  
         1. Edit 
         ```
         /etc/insights-client/malware-detection-config.yml
         ```   
         a. Set the test scan processes from false to true
        ```
        scan_processes: true
        ```
        b. Save changes
	    
        2. Run the malware detection collector again        
        ```
         sudo insights-client --collector malware-detection
         ```
      # optional - the task's Check your work module
      review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
      summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header

    - title: Review results 
      description: |-
        Now you are ready to view your results.
      introduction: |-
        Welcome to the quick start for viewing your results. 
        In this quick start, you will navigate through Insights to the Malware service to view the matched signatures. 
  
    - title: Review YARA Matches in Insights 
         1. Go to Red Hat Hybrid Cloud Console.
         2. Navigate to **Insights for RHEL**.
         3. Click **Security** in the left navigation panel. 
         4. Select Malware in the dropdown.
         5. You can click on **Systems** OR **Signatures** to see different views. 

      # optional - the task's Check your work module
      review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
      summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header

      conclusion: |-
   
      <h4><b>Thank you for taking the time to explore this feature!</b></h4> 
      
      If you need additional assistance, [open a support case](https://access.redhat.com/support).
  
