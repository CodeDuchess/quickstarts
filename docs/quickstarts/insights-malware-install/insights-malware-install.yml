# Additional info: https://docs.openshift.com/container-platform/4.9/web_console/creating-quick-start-tutorials.html
metadata:
  name: insights-malware-install
  # you can add additional metadata here
  instructional: true
spec:
  displayName: Install, test and run the malware detection Service
  durationMinutes: 10
  # Optional type section, will display as a tile on the card
  type:
    text: Quick start
    # 'blue' | 'cyan' | 'green' | 'orange' | 'purple' | 'red' | 'grey'
    color: grey
  icon: data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KPHRpdGxlPjwvdGl0bGU+CjxnIGlkPSJpY29tb29uLWlnbm9yZSI+CjwvZz4KPHBhdGggZD0iTTQ0OCA2NHY0MTZoLTMzNmMtMjYuNTEzIDAtNDgtMjEuNDktNDgtNDhzMjEuNDg3LTQ4IDQ4LTQ4aDMwNHYtMzg0aC0zMjBjLTM1LjE5OSAwLTY0IDI4LjgtNjQgNjR2Mzg0YzAgMzUuMiAyOC44MDEgNjQgNjQgNjRoMzg0di00NDhoLTMyeiI+PC9wYXRoPgo8cGF0aCBkPSJNMTEyLjAyOCA0MTZ2MGMtMC4wMDkgMC4wMDEtMC4wMTkgMC0wLjAyOCAwLTguODM2IDAtMTYgNy4xNjMtMTYgMTZzNy4xNjQgMTYgMTYgMTZjMC4wMDkgMCAwLjAxOS0wLjAwMSAwLjAyOC0wLjAwMXYwLjAwMWgzMDMuOTQ1di0zMmgtMzAzLjk0NXoiPjwvcGF0aD4KPC9zdmc+Cg==
  prerequisites:
    - The system operating system must be RHEL8 or RHEL9
    - The administrator must have sudo access on the system
    - The system must have the Insights client package installed, and be registered to Insights for Red Hat Enterprise Linux.
  description: |-

    Install and register the malware service
    
  introduction: |-
    Welcome to the quick start that will install YARA and the Insights-client. YARA is an open-source and multi-platform tool that detects code similarities between predefined malware signatures and a scanned RHEL 
    system. If one or more conditions in a predefined signature exist on a scanned RHEL system, YARA records a malware hit on that system. 
    Install the YARA Package on each host you want to scan for Malware and Ensure the Systemâ€™s Operating System versions are either RHEL 8 or RHEL 9.  
   
  tasks:
    - title: Install and register
      description: |-    
      
      You will install YARA, the Insights-client and register your system.  

        1. Install YARA: 
        ```
        sudo dnf install yara
        ````
        2. Install the Insights-client RPM:
        ```
        sudo dnf install insights-client
        ```
        3. Test the Insights-client connection:
        ```
        sudo insights-client --test-connection
        ```
        4. Register the system with Insights for Red Hat Enterprise Linux:
        ```
        sudo insights-client --register
        ```
        After everything is successfully installed and registered, you are now ready to run the client malware detection collector.

    - title: Initial test run of the malware detection collector
      description: |-

      This is a very minimal scan of your system with using a simple test rule. 
      The test scan is designed to verify that the installation, operation, and uploads are working 
      correctly for the malware detection service. There will be a couple of matches found but this is
      intentional and nothing to worry about. Results from the initial test scan will not appear 
      in the malware detection service UI.

       1. Run the Insights-client malware detection collector 
       ```
       sudo insights-client --collector malware-detection
       ```

       The initial run creates a malware detection configuration file in 
       `/etc/insights-client/malware-detection-config.yml`, performs a test scan, 
       and uploads the results.
        
        2. Perform a full filesystem scan.
        Edit `/etc/insights-client/malware-detection-config.yml` 
          a. Set the test scan option from true to false 
             test_scan: false
          b. Minimize scan time by setting any of the following options: 
             `Filesystem_scan_only`

             `Filesystem_scan_exclude`

             `Filesystem_scan_since`
             
          c. Re-run the client malware detection collector
          ```
          sudo insights-client --collector malware-detection
          ```
        Once you have completed the test run and full filesystem scan, you are ready to view your results.   

    - title: Review YARA matches in the Insights dashboard
      description: |- 
      
      In this next task, you will leave this UI and navigate to the Hybrid Cloud Console, and then to the Insights for RHEL Malware tab to view the matched signatures results. 

        1. Navigate to [Red Hat Hybrid Cloud Console](https://console.redhat.com/).
        2. Navigate to **Insights for RHEL**.
        3. Click **Security** in the left navigation panel. 
        4. Select Malware in the dropdown.
        5. You can click on **Systems** or **Signatures** to see different views.

      In most cases, running a malware detection scan with YARA will result in no signature matches.
      If the scan does detect a match, provide the details of the match to your security incident response team.

      # optional - the task's Check your work module
       review:
        instructions: |-
          - Did you complete the task successfully?
        failedTaskHelp: This task isn't verified yet. Try the task again.
      # optional - the task's success and failure messages
       summary:
        success: Shows a success message in the task header
        failed: Shows a failed message in the task header

  conclusion: |-
   
      <h4><b>Thank you for taking the time to explore this feature!</b></h4> 
      
      If you need additional assistance, [open a support case](https://access.redhat.com/support).

  
